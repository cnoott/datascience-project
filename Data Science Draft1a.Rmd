---
title: "Data Science Draft"
author: "Shadae Lewis"
date: "3/27/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Importing the data

Column names:
snoring - snoring range of the user (snoring rate) 
respiration - respiration rate
bodytemp - body temperature 
limb - limb movement rate 
bloodO - blood oxygen levels
eye - eye movement
sleephrs - number of hours of sleep
heart - heart rate 
stress - Stress Levels (0- low/normal, 1 – medium low, 2- medium, 3-medium high, 4 -high)

```{r}


sleep_stress = read.csv(file = "SleepStress.csv",sep=",", header=TRUE, col.names = c("snoring", "respiration", "bodytemp", "limb", "bloodO", "eye","sleephrs", "heart", "stress"))

sleep_stress
```


Playing with the data

```{r}
summary(sleep_stress)

```

```{r}
#correlation
cor(sleep_stress)

pairs(sleep_stress)

```

Decision Tree

```{r}
library(tree)
library(boot)

#convert stress to factor
sleep_stress$stress = as.character(sleep_stress$stress)

#Renaming the values
#(0- low/normal, 1 – medium low, 2- medium, 3-medium high, 4 -high)
sleep_stress$stress[sleep_stress$stress == '0'] = "low/normal"
sleep_stress$stress[sleep_stress$stress == '1'] = "medium low"
sleep_stress$stress[sleep_stress$stress == '2'] = "medium"
sleep_stress$stress[sleep_stress$stress == '3'] = "medium high"
sleep_stress$stress[sleep_stress$stress == '4'] = "high"

```


Before training and testing sets
```{r}
sleep_stress$stress = as.factor(sleep_stress$stress)

tree.sleep.stress = tree(stress~.,sleep_stress)
summary(tree.sleep.stress)

plot(tree.sleep.stress)
text(tree.sleep.stress,pretty = 0)

```


With training and testing sets
```{r}

#for(i in 1:10){
  
##training and testing sets
set.seed(2)
sample =sample(nrow(sleep_stress), nrow(sleep_stress)*.8)
train = sleep_stress[sample,]
test = sleep_stress[-sample,]



##unpruned
tree.model = tree(stress ~ ., data = sleep_stress,subset = sample)
summary(tree.model)

plot(tree.model)
text(tree.model, pretty=TRUE)



##testing the unpruned model
model.pred = predict(tree.model,test,type = "class")
matrix = table(model.pred,test$stress)
matrix

#error rate 
matrix[4,3]/sum(matrix)

```

```{r}

##cross validation 
cv.sleep_stress = cv.tree(tree.model,FUN = prune.misclass)
cv.sleep_stress

## 5 is still the best number of nodes
plot(cv.sleep_stress$size,cv.sleep_stress$dev,type = "b")



##prune
prune.sleep_stress = prune.misclass(tree.model,best = 5)

plot(prune.sleep_stress)
text(prune.sleep_stress,pretty = 0)



##testing the pruned model
tree.pred = predict(prune.sleep_stress,test,type = "class")
matrix2 = table(tree.pred,test$stress)
matrix2

##error rate 
matrix2[4,3]/sum(matrix2)

#}
```
Random Forest

```{r}

library(randomForest)

means.rf = c(); #creating empty list to collect each mean value

for (i in c(1:10))   #setting up the for loop for each seed i 
{
set.seed(i)        
  
sleep_stress$stress = as.factor(sleep_stress$stress)   # setting the data response as a factor
train.rf = sample(nrow(sleep_stress), nrow(sleep_stress)*.8)   # 80/20 training and testing set
test.rf = sleep_stress[-train.rf,]                             # testing set

sleep.rf = randomForest(stress ~., data = sleep_stress,       # random forest model w/ training data
                        subset = train.rf,
                        mtry=(ncol(sleep_stress)-1)/3 ,  
                        importance = TRUE)

sleep.rf

yhat.rf = predict(sleep.rf, newdata = test.rf)              # running model w/ test data

#mean((yhat.rf - test.rf$stress)^2) 

means.rf[i] = mean((yhat.rf != test.rf$stress)^2)            # 




}

print("Mean values of each i:")
print(means.rf)

print(mean(means.rf))

importance(sleep.rf)
varImpPlot(sleep.rf, sort = TRUE, main = "Output")

```